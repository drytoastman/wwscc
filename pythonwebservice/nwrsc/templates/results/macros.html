
{% macro classtables() -%}
<table class='classresults'>
{% for code,entrants in g.results.items()|sort %}
	{{headerrow(code)}}
	{% for e in entrants %}
		{{entrantrow(e)}}
		{%- for runs in e.runs[1:] -%}
			<tr>
			{% for run in runs -%}
				{{runcell(run)}}
            {%- endfor -%}
			</tr>
        {%- endfor -%}
    {% endfor %}
{% else %}
	<tr><td>No results found</td></tr>
{% endfor %}
</table>
{%- endmacro %}



{% macro headerrow(classcode) -%}
{% set colcount = 6 + g.event.runs %}
<tr>
	<th class='classhead' colspan='{{colcount}}'>
	<a name='{{classcode}}'>{{classcode}}</a> - {{g.classdata.classlist[classcode].descrip}}
	</th>
</tr>
<tr>
<th class='pos'>#</th>
<th class='trophy'>T</th>
<th class='name'>Entrant</th>
{% for ii in range(1, g.event.runs+1) -%}
	<th class='run'>Run {{ii}}</th>
{% endfor %}
<th></th>  {# Extra col to fix firefox border bug #}
<th class='total'>Total</th>
<th class='points'>Points</th>
</tr>
{%- endmacro %}



{%- macro entrantrow(entrant) %}
{% set rowspan = "rowspan='%s'" % (g.event.courses) %}
<tr class='entrantrow'>
	<td class='pos' {{rowspan|safe}}>{{entrant.position}}</td>
	<td class='trophy' {{rowspan|safe}}>{{entrant.trophy and 'T' or ''}}</td>
	<td class='name' align='center' {{rowspan|safe}}>#{{entrant.number}} - {{entrant.firstname}} {{entrant.lastname}}<br/>
		{{entrant.make}} {{entrant.model}} {{entrant.color}} {{entrant.indexstr and "(%s)"%entrant.indexstr or ""}}</td>
	{% for run in entrant.runs[0] -%}
		{{runcell(run)}}
	{%- endfor %}
	<td {{rowspan|safe}}></td> {# Extra col to fix firefox border bug #}
	<td class='total' {{rowspan|safe}}>{{entrant.net | t3}}</td>
	<td class='points' {{rowspan|safe}}>{{entrant.points | t3}}</td>
	{# Can reference entrant.pospoints or entrant.diffpoints to bypass series setting for points type #}
</tr>
{% endmacro %}



{%- macro runcell(run) %}
{%- if not run -%}
<td class='run'>
no data
{%- else -%}
<td class='run {{run.netorder==1 and "bestnet"}} {{run.raworder==1 and "bestraw"}}'>
{%- if run.status == "OK" -%}
	<span class='net'>{{run.net | t3}}</span>
{%- else -%}
	<span class='net'>{{run.status}}</span>
{%- endif -%}
{%- if run.raw != 999.999 -%} <span class='raw'>{{run.raw|t3}} ({{run.cones}},{{run.gates}})</span> {%- endif -%}
{%- if run.reaction or run.sixty -%} <span class='reaction'>{{run.reaction|t3}}/{{run.sixty | t3}}</span> {%- endif -%}
{%- endif -%}
</td>
{% endmacro -%}



{% macro toptimestable(table) %}
<table class='toptimes'>
<tr>
{% for title in table.titles -%}
<th class='toptimeshead' colspan='{{table.colcount[loop.index0]+1}}'>{{title}}</th>
{%- endfor -%}
</tr>

<tr>
{% for ttlcols in table.cols -%}
<th>#</th>
{%- for col in ttlcols -%}
<th>{{col}}</th>
{%- endfor -%}
{%- endfor -%}
</tr>
{% for ttlrow in table.rows %}
<tr>
{% set pos=loop.index %}
{%- for row in ttlrow -%}
<td class='pos'>{{pos}}</td>
{%- for item in row -%}
<td>{{item|t3}}</td>
{%- endfor -%}
{%- endfor -%}
</tr>
{%- endfor %}
</table>
{% endmacro %}

