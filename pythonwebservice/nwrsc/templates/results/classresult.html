{% extends "base.html" %}
{% set colcount = 6 + g.event.runs %}
{% set rowspan = "rowspan='%s'" % (g.event.courses) %}

{% block headers %}
<link rel="stylesheet" href="/static/results.css" />
{% endblock %}

{% block content %}
{% if ispost %}
	{{eventpost()}}
{% else %}
	{{resulttables()}}
{% endif %}
{% endblock content %}


{% macro eventpost() %}
<!-- Series info -->
<div id='seriescustom'>
{{g.settings.customheader|safe}}
</div>

<div id='seriestitle'>{{g.settings.seriesname}}</div>

<!-- Event info -->
<div id='eventtitle'>{{g.event.date}} - {{g.event.name}}</div>
<div id='hosttitle'>Hosted At: <span class='host'>{{g.event.attr.location}}</span></div>
<div id='entrantcount'>({{g.entrantcount}} Entrants)</div>

<hr />
<!-- Results -->

<div id='classlinks'>
{% for cls in g.results|sort -%}
<a href='#{{cls}}'>{{cls}}</a>
{% endfor %}
</div>

{{resulttables()}}

<br/>
<br/>
{# ${toptimestable([c.toptimes.getList(allruns=False, raw=False, course=0), c.toptimes.getList(allruns=False, raw=True, course=0)])} #}
{% endmacro %}



{% macro resulttables() -%}
<table class='classresults'>
{% for code,entrants in g.results.items()|sort %}
	{{headerrow(code)}}
	{% for e in entrants %}
		{{entrantrow(e)}}
		{%- for runs in e.runs[1:] -%}
			<tr>
			{% for run in runs -%}
				{{runcell(run)}}
            {%- endfor -%}
			</tr>
        {%- endfor -%}
    {% endfor %}
{% else %}
    No results found
{% endfor %}
</table>
{%- endmacro %}



{% macro headerrow(classcode) -%}
<tr>
	<th class='classhead' colspan='{{colcount}}'>
	<a name='{{classcode}}'>{{classcode}}</a> - {{descrip}}
	</th>
</tr>
<tr>
<th class='pos'>#</th>
<th class='trophy'>T</th>
<th class='name'>Entrant</th>
{% for ii in range(1, g.event.runs+1) -%}
	<th class='run'>Run {{ii}}</th>
{% endfor %}
<th></th>  {# Extra col to fix firefox border bug #}
<th class='total'>Total</th>
<th class='points'>Points</th>
</tr>
{%- endmacro %}



{%- macro entrantrow(entrant) %}
<tr class='entrantrow'>
	<td class='pos' {{rowspan|safe}}>{{entrant.position}}</td>
	<td class='trophy' {{rowspan|safe}}>{{entrant.trophy and 'T' or ''}}</td>
	<td class='name' align='center' {{rowspan|safe}}>#{{entrant.number}} - {{entrant.firstname}} {{entrant.lastname}}<br/>
		{{entrant.make}} {{entrant.model}} {{entrant.color}} {{entrant.indexstr and "(%s)"%entrant.indexstr or ""}}</td>
	{% for run in entrant.runs[0] -%}
		{{runcell(run)}}
	{%- endfor %}
	<td {{rowspan|safe}}></td> {# Extra col to fix firefox border bug #}
	<td class='total' {{rowspan|safe}}>{{entrant.sum | t3}}</td>
	<td class='points' {{rowspan|safe}}>{{entrant.points | t3}}</td>
	{# Can reference entrant.pospoints or entrant.diffpoints to bypass series setting for points type #}
</tr>
{% endmacro %}



{%- macro runcell(run) %}
{%- if not run -%}
<td class='run'>
blank
{%- else -%}
<td class='run {{run.bestnet and "bestnet"}} {{run.bestraw and "bestraw"}}'>
{%- if run.status == "OK" -%}
	<span class='net'>{{run.net | t3}}</span>
{%- else -%}
	<span class='net'>{{run.status}}</span>
{%- endif -%}
{%- if run.raw != "999.999" -%} <span class='raw'>{{run.raw | t3}} ({{run.cones}},{{run.gates}})</span> {%- endif -%}
{%- if run.reaction or run.sixty -%} <span class='reaction'>{{run.reaction|t3}}/{{run.sixty | t3}}</span> {%- endif -%}
{%- endif -%}
</td>
{% endmacro -%}


