{% extends "register/rbase.html" %}
{% import '/register/macros.html' as m %}

{% macro disablecar(car) %}
{%if car.regevents|length > 0 %}
disabled='disabled' title='Cars registered or in use cannot be edited or deleted'
{% endif %}
{% endmacro %}

{% macro disableevent(event) %}
{% if not event.isOpen() %}
disabled='disabled' title='Event registration is not open or car has runs so this assignment cannot be changed' \
{% endif %}
{% endmacro %}

{% block content %}
{{m.navbar('cars')}}

<div class='container'>
{{ m.formerrors(formerror) }}

<table id='carlist'>
<tr><th></th><th></th><th><span>Cars</span></th><th><span>Registered/Used In</span></th></tr>
{% for car in cars %}
	<tr>
	<td><button class='editcar' data-driverid='{{c.driverid}}' data-carid='{{car.id}}' {{disablecar(car)}} >Edit</button></td>
	<td><button class='deletecar' data-carid='{{car.id}}' {{disablecar(car)}}>Delete</button></td>
	<td class='car'>{{carDisplay(car)}}</td>
	<td class='carevents'>
		%if len(car.regevents) > 0:
		<ul>
		%for (event, regid) in car.regevents:
			<li>
			<button class='unregbutton' data-eventid='{{event.id}}' data-regid='{{regid}}' {{disableevent(event)}}>Unregister</button>
			<span class='regevent'>{{event.name}}</span>
			</li>
		%endfor
		</ul>
		%endif
	</td>
	</tr>
{% endfor %}
</table>


</div>

{% endblock content %}
