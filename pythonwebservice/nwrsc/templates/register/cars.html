{% extends "register/rbase.html" %}
{% import '/register/macros.html' as m %}

{% macro disablecar(car) %}
{%if car.regevents|length > 0 %}
{% endif %}
{% endmacro %}

{% macro disableevent(event) %}
{% if not event.isOpen() %}
{% endif %}
{% endmacro %}

{% block content %}
{{m.navbar('cars')}}

<div id='carscontainer' class='container'>

<div class='row justify-content-center'>
<div class='col-8'>
{{ m.formerrors(formerror) }}
</div>
</div>

<div class='row title'>
<div class='col'>Cars In {{g.series}}</div>
<div class='col'>Registered/Used In</div>
</div>

{% for car in cars.values()|msort("classcode","number") %}
<div class='row'>
<div class='col'>
    {% if registered[car.carid]|length > 0 %}
	    <button class='btn btn-outline-secondary disabled fa fa-pencil' title='Cars registered or in use cannot be edited or deleted'></button>
    	<button class='btn btn-outline-secondary disabled fa fa-trash' title='Cars registered or in use cannot be edited or deleted'></button>
    {% else %}
    	<button class='editcar   btn btn-outline-primary fa fa-pencil' title='Edit Car' data-carid='{{car.id}}'></button>
    	<button class='deletecar btn btn-outline-primary fa fa-trash' title='Delete Car' data-carid='{{car.id}}'></button>
    {% endif %}
	{{m.carDisplay(car)}}
</div>
<div class='col'>
	<ul>
    {% for eventid in registered[car.carid] %}
        {% set event = events[eventid] %}
		<li>
        {% if not event.isOpen() %}
    		<button class='unreg btn btn-outline-secondary fa fa-trash disabled' title='Event registration is not open or car has runs so this assignment cannot be changed'></button>
        {% else %}
    		<button class='unreg btn btn-outline-primary fa fa-trash' title='Unregister' data-eventid='{{eventid}}' data-carid='{{car.carid}}' {{disableevent(event)}}></button>
        {% endif %}
		<span class='regevent'>{{event.name}}</span>
		</li>
	{% endfor %}
	</ul>
</div>
</div>
{% endfor %}

</div>

{% endblock content %}
